<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>
			{% block title %}Gabriel.dev
			{% endblock %}
		</title>
		<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
		<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
		{% block stylesheets %}{% endblock %}
		{% block javascripts %}
			{% block importmap %}
				{{ importmap('app') }}
			{% endblock %}
		{% endblock %}
		<script>
			// Dark mode init
			const theme = localStorage.getItem('theme') || 'light';
			document.documentElement.setAttribute('data-theme', theme);
		</script>
	</head>
	<body class="{% block body_class %}{% endblock %}">
		<nav class="navbar navbar-expand-lg navbar-light border-bottom">
			<div class="container">
				<a class="navbar-brand fw-bold" href="{{ path('app_home') }}">Gabriel.dev</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav me-auto">
						<li class="nav-item">
							<a class="nav-link" href="{{ path('app_home') }}">Accueil</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="{{ path('app_post_index') }}">Articles</a>
						</li>
						{% if is_granted('ROLE_ADMIN') %}
							<li class="nav-item">
								<a class="nav-link position-relative" href="{{ path('app_admin_dashboard') }}">
									Administration
									{% set unreadCount = unread_comments_count() %}
									{% if unreadCount > 0 %}
										<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
											{{ unreadCount }}
											<span class="visually-hidden">commentaires non lus</span>
										</span>
									{% endif %}
								</a>
							</li>
						{% endif %}
					</ul>
					
					<button id="theme-toggle" class="btn btn-sm btn-outline-secondary me-3" title="Basculer le theme" data-controller="theme" data-action="click->theme#toggle">
						<i class="bi bi-moon" data-theme-target="icon"></i>
					</button>

					<form class="d-flex me-3" action="{{ path('app_post_search') }}" method="get">
						<input class="form-control form-control-sm me-2" type="search" name="q" placeholder="Rechercher..." value="{{ app.request.query.get('q') }}">
						<button class="btn btn-outline-secondary btn-sm" type="submit">OK</button>
					</form>
					<ul class="navbar-nav d-flex align-items-center">
						{% if app.user %}
							<li class="nav-item">
								<a class="nav-link" href="{{ path('app_profile') }}" title="Mon profil">
									{% if app.user.profilePicture %}
										<img src="{{ asset('uploads/profiles/' ~ app.user.profilePicture) }}" alt="Profil" class="rounded-circle" style="width: 30px; height: 30px; object-fit: cover; border: 2px solid var(--profile-border);">
									{% elseif app.user.googleAvatar %}
										<img src="{{ app.user.googleAvatar }}" alt="Profil" class="rounded-circle" style="width: 30px; height: 30px; object-fit: cover; border: 2px solid var(--profile-border);">
									{% else %}
										<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-person-circle" viewbox="0 0 16 16">
											<path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
											<path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
										</svg>
									{% endif %}
								</a>
							</li>
							<li class="nav-item ms-3">
								<a class="btn btn-sm btn-custom-logout" href="{{ path('app_logout') }}">Deconnexion</a>
							</li>
						{% else %}
							<li class="nav-item">
								<a class="nav-link" href="{{ path('app_login') }}">Connexion</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="{{ path('app_register') }}">Inscription</a>
							</li>
						{% endif %}
					</ul>
				</div>
			</div>
		</nav>

		<main class="container my-4">
			{% for label, messages in app.flashes %}
				{% for message in messages %}
					<div class="alert alert-{{ label }} alert-dismissible fade show">
						{{ message }}
						<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
					</div>
				{% endfor %}
			{% endfor %}

			{% block body %}{% endblock %}
		</main>

		<footer class="border-top py-3">
			<div class="container text-center text-muted">
				<small>&copy;
					{{ "now"|date("Y") }}
					Gabriel.dev</small>
			</div>
		</footer>

		{% set jukebox_songs = [
            { title: 'Nujabes - Luv(sic) pt.1', src: asset('jukebox/sounds/pt1.mp3'), cover: asset('jukebox/images/nujabes.png') },
            { title: 'Nujabes - Luv(sic) pt.2', src: asset('jukebox/sounds/pt2.mp3'), cover: asset('jukebox/images/nujabes.png') },
            { title: 'Nujabes - Luv(sic) pt.3', src: asset('jukebox/sounds/pt3.mp3'), cover: asset('jukebox/images/nujabes.png') },
            { title: 'Nujabes - Luv(sic) pt.4', src: asset('jukebox/sounds/pt4.mp3'), cover: asset('jukebox/images/nujabes.png') },
            { title: 'Nujabes - Luv(sic) pt.5', src: asset('jukebox/sounds/pt5.mp3'), cover: asset('jukebox/images/nujabes.png') },
            { title: 'Nujabes - Luv(sic) pt.6', src: asset('jukebox/sounds/pt6.mp3'), cover: asset('jukebox/images/nujabes.png') },
            { title: 'Climalindo', src: asset('jukebox/sounds/climalando.mp3'), cover: asset('jukebox/images/climalindo.jpeg') },
            { title: 'Combo 696', src: asset('jukebox/sounds/Combo 696.mp3'), cover: asset('jukebox/images/combo.jpeg') },
            { title: 'Squeezie - Top 1', src: asset('jukebox/sounds/SQUEEZIE - TOP 1.mp3'), cover: asset('jukebox/images/top1.jpg') }
        ] %}

		<div data-controller="jukebox" data-jukebox-songs-value="{{ jukebox_songs|json_encode|e('html_attr') }}">
			<div class="jukebox-panel" data-jukebox-target="panel">
				<button class="jukebox-minimize" data-action="jukebox#minimize">−</button>
				<button class="jukebox-close" data-action="jukebox#close">X</button>
				<div class="jukebox-disc">
					<img src="{{ asset('jukebox/images/nujabes.png') }}" alt="Cover" class="jukebox-cover" data-jukebox-target="cover">
					<div class="jukebox-hole"></div>
				</div>
				<p class="jukebox-title" data-jukebox-target="title">Nujabes - Luv(sic) pt.1</p>
				<div class="jukebox-controls">
					<button class="jukebox-ctrl-btn" data-action="jukebox#prev">PREV</button>
					<button class="jukebox-ctrl-btn jukebox-play" data-action="jukebox#play" data-jukebox-target="playBtn">PLAY</button>
					<button class="jukebox-ctrl-btn" data-action="jukebox#next">NEXT</button>
				</div>
				<div class="jukebox-volume-container">
					<span class="jukebox-volume-label">VOL</span>
					<input type="range" min="0" max="1" step="0.05" value="1" class="jukebox-volume-slider" data-action="input->jukebox#changeVolume" data-jukebox-target="volume">
				</div>
			</div>

			<div class="jukebox-mini" data-jukebox-target="mini" data-action="click->jukebox#restore">
				<img src="{{ asset('jukebox/images/nujabes.png') }}" alt="Cover" class="jukebox-mini-cover" data-jukebox-target="miniCover">
			</div>

			<button class="jukebox-toggle-btn" data-action="jukebox#toggle">Musique ?</button>
		</div>
	</body>
</html>
